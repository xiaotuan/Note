### 1. diff命令

例如：

```shell
$ diff -u hello world > diff.txt
```

> 注意：`-u` 参数很重要，使得差异输出中带有上下文。

**文件 hello**

```text
应该杜绝文章中的错别字。

但是无论使用
*全拼，双拼
*还是五笔

是人就有可能犯错，软件更是如此。

犯了错，就要扣工资！

改正的成本可能会很高。
```

**文件 world**

```text
应该杜绝文章中的错别子。

但是无论使用
*全拼，双拼
*还是五笔

是人就有可能犯错，软件更是如此。

改正的成本可能会很高。

但是 “只要眼球足够多，所有 Bug 都好捉”，
这就是开源的哲学之一。
```

**diff.txt**

```text
--- hello	2021-05-14 16:14:16.783399908 +0800
+++ world	2021-05-14 16:14:24.927399908 +0800
@@ -1,4 +1,4 @@
-应该杜绝文章中的错别字。
+应该杜绝文章中的错别子。
 
 但是无论使用
 *全拼，双拼
@@ -6,6 +6,7 @@
 
 是人就有可能犯错，软件更是如此。
 
-犯了错，就要扣工资！
-
 改正的成本可能会很高。
+
+但是 “只要眼球足够多，所有 Bug 都好捉”，
+这就是开源的哲学之一。
```

上面的差异文件，可以这么理解：

+ 第 1 行和第 2 行分别记录了原始文件和目标文件的文件名及时间戳。以三个减号（ --- ）开始的行标识的是原始文件，以三个加号（ +++ ）开始的行标识的是目标文件。
+ 在比较内容中，以减号（ - ）开始的行是只出现在原始文件中的行，例如：第 4、13、14 行。
+ 在比较内容中，以加号（ + ）开始的行是只出现在目标文件中的行，例如：第 5 行和 16 - 18 行。
+ 在比较内容中，以空格开始的行，是在原始文件和目标文件中都出现的行，例如：第 6 - 8、10 - 12和第 15 行。这些行是用作差异比较的上下文。
+ 第 3 - 8 行是第一个差异小节。每个差异小节以一行差异定位语句开始。第 3 行就是一条差异定位语句，其前后分别用两个 @ 进行标识
+ 第 3 行定位语句中 -1，4 的含义是：本差异小节的内容相当于原始文件的从第 1 行开始的 4 行。而第 4、6、7、8 行是原始文件中的内容，加起来刚好是 4 行。
+ 第 3 行定位语句中 +1，4 的含义是：本差异小节的内容相当于目标文件的从第 1 行开始的 4 行。而第 5、6、7、8 行是目标文件中的内容，加起来刚好是 4 行。
+ 因为命令 diff 是用于行比较的，所以即使改正了一个字，也显示为一整行的修改（参见差异文件第 4、5 行）。Git 对 diff 进行了扩展，并且还提供一种逐词比较的差异比较方法，参见本书第 2 篇的第11.4.4 小节。
+ 第 9 - 18 行是第二个差异小节。第 9 行是一条差异定位语句。
+ 第 9 行定位语句中 -6，6 的含义是：本差异小节的内容相当于原始文件的从第 6 行开始的 6 行。第 10 - 15 行是原始文件中的内容，加起来刚好是 6 行。
+ 第 9 行定位语句中 +6，7 的含义是：本差异小节的内容相当于目标文件的从第 6 行开始的 7 行。而第 10 - 12、15 - 18 行是目标文件中的内容，加起来刚好是 7 行。

### 2. patch 命令

`patch` 命令相当于 `diff` 的反向操作。有了 hello 和 diff.txt 文件，可以放心地将 world 文件删除或用 hello 文件将 world 文件覆盖。用下面的命令可以还原 world 文件：

```shell
$ cp hello world
$ patch world < diff.txt
```

