# 前言

Node.js的出现已经有一段时间了，而且已经被很多大公司（LinkedIn、Yahoo!和Netflix）使用，但它仍然很年轻，以至于很多公司的中层管理人员在进行决策时对它存有疑虑。它的成功促使我们去创造一种更为复杂的JavaScript，也让我们可以没有后顾之忧地使用新的语言特性。反过来，最新版的JavaScript也推动了Node.js的组织改革和发布规范的设立。

Node.js重新定义了我们能用JavaScript干什么。现在，雇主不但要求JavaScript程序员能在我们所熟知的浏览器端进行开发，也要求他们能进行服务端开发。另外，Node.js创造了一种新的服务端语言，这种新的语言正在不断吸引着Ruby、C++、Java和PHP的服务端开发人员（尤其是其中一些会JavaScript的开发人员）。

我觉得Node.js很有趣。因为相对于很多其他环境而言，它的门槛很低，很容易创建和运行应用，用它尝试新想法也比较容易。Node项目所需要的环境配置比其他语言要简单和直观一些。只有PHP的环境配置的简单程度可以媲美Node，但即便如此，PHP还是需要和Apache结合起来，才能创建出对外可用的应用。

虽然听着简单，但Node.js也有复杂的地方。学习Node.js意味着你需要学习如何配置环境、掌握核心API，但同时，发现并掌握其复杂的一面也很重要。

## 本书所面向的读者

我觉得本书的受众有两种人。

第一种是已经使用过各种库和框架搭建前端应用，现在想要将自己的JavaScript知识扩展到服务端的开发人员。

第二种是想要尝试新鲜事物，或者学习新技术的后端开发人员。这些开发人员从事过Java、C++、Ruby或者PHP的开发工作，但现在他们想要把时不时接触过的JavaScript知识体系化，并和已知的服务端知识结合起来。

这两种看似没有交集的读者有一个共同点，就是都使用JavaScript，或者可以更准确地称为ECMAScript。本书也确实要求读者对JavaScript比较熟悉。这两种读者的另外一个共同点是：都必须学习同样的Node基础知识，包括Node核心API。

然而，不同的读者，因为拥有不同的视角、不同的技能，所以学习体验也会不尽相同。为了协调一致，我会在本书从不同的视角进行讲解。比如说，一个C++或者Java程序员可能会有兴趣创建C++的Node插件，而这对于前端开发者来说可能没多少吸引力。同样，一些类似于“大端”（big-endian）的概念可能对后端开发者来说很熟悉，而对前端开发者来说可能是一头雾水。我没办法从每一种视角进行过于深入的讲解，但我会确保所有的读者都不会看不懂，或者感觉乏味。

有一件事我绝对不会做，就是强迫读者死记硬背。我们会讲到核心模块API，但是我不会逐个讲解其中的对象和函数，因为它们在Node网站上都有文档。相对而言，我会挑选每个模块中的重要方面进行讲解，或者针对Node中一些特定的重要功能进行讲解，从而给读者提供一个可以和其他Node开发人员进行交流的基础。当然了，熟能生巧，而且本书只是一个学习工具。读完本书之后，读者还需要继续对Node进行深入的探索，比如在Mongo-Express-Angular-Node（MEAN）技术栈上工作。Node中有很多方向可以选择，本书将会为读者提供一些建议。

> **聊聊Node文档**
> 写作本书之时，我和其他一些Node开发者正在进行一个关于Node.js网站现存问题的讨论，其中一点就是关于如何定义Node.js的“当前”版本，也就是说，当用户访问“这个”文档时，应该显示什么样的版本。
> 我最后一次参与这个讨论的时候，大家的计划是在/docs页面列出Node.js的所有当前的长期维护（LTS）版本，还要列出当前的稳定版本，同时要在页面顶端显示出当前文档的版本号。
> 最终，文档的维护人员想要针对每个页面生成一个版本差异（version diffs），但这将会是一个艰巨的任务。
> 本书出版之时，Node发布了6.0.0版本，它是当前版本，并且它不再将活跃开发分支称为稳定版（Stable）。因此，Node.js 6.0.x最终将被转至下一个LTS版本。
> 因为Node的版本如此之多，所以每当你访问Node API的文档网站时，一定要检查文档版本与你使用的Node版本是否一致。当然，查看一下新版文档中的新功能也没什么坏处。



> <img class="my_markdown" src="./images/1.png" style="zoom:50%;" />
> **Node.js就是Node**
> 官方名称Node.js实际上极少被人使用，所有人都称之为“Node”。本书中绝大部分地方也会使用Node来指代Node.js。

## 本书结构

本书着重于基础，重点讲解Node和组成Node核心的一些模块，我也会稍微涉及一些第三方模块，并把npm作为扩展知识来讲解，但是本书最重要的目标还是为读者讲解Node的基础功能。有了这些基础知识，读者就可以在不同方向进行深入研究。

第1章主要是对Node的介绍，其中有一节介绍了如何安装Node。读者还可以对Node进行一些探索，包括使用Node文档中的代码创建一个Web服务器，接着使用我提供的代码创建一个稍微高级一点儿的Web服务器。我也会为读者中的C/C++程序员讲解如何创建Node插件。另外，讲解Node怎么能抛开它的历史不谈呢？更别说Node的历史还真是与众不同，因为它跳过了1.0版本，直接发布了4.0版本。

第2章主要讲解Node的核心功能，包括如何处理事件，以及各种功能赖以生存的global对象，还有Node的异步特性。另外，我还会讲解缓冲器（buffer）对象，也就是Node里用来在网络服务中进行数据传输的数据结构。

第3章会深入讲解Node的模块系统，包括深入研究npm——Node的一个第三方模块管理系统。这一章中，读者将会学习到如何将自己的应用与Node模块集成，以及如何创建自己的Node模块。最后，我会讲解Node功能中一个稍微高级点的内容——沙箱（sandboxing）。同时，为了让学习更有趣，我会介绍3个流行的Node第三方模块：Async、Commander和Underscore。

在第4章中，我会用整章的篇幅来讲解一个很有价值的学习工具，Node的互动式控制台——REPL，其本身也是一个开发环境。我会详细讲解如何使用这个工具，还会介绍如何创建自己的REPL。

在第5章，我们会探索Node的Web应用，包括去了解有哪些Node模块支持了Web开发。在这一章，读者可以学习如何构建一个功能完整的Web服务器，以及如何使用Apache代理将Node应用和Apache一起运行。

Node可以在多种环境下运行，如Windows，基于UNIX的OS X，还有Linux。这是因为Node提供了一系列可以屏蔽系统差异的功能，这部分内容我们会在第6章讲到。另外，我还会讲到Node中的流（stream）和管道（pipe）的基础知识。它们是一切输入输出的核心，另外本章还会介绍Node对文件系统的支持。

第7章全部是关于网络的。说到网络，就不能不涉及安全。这两部分内容总是会同时出现。我会介绍Node对TCP和UDP的支持，以及如何实现一个HTTPS服务器，这作为第5章学习实现HTTP服务器的补充。另外我还会介绍数字证书背后的机制，以及SSL（Secure Sockets Layer，安全套接层）的基础，还有它的升级版TLS（Transport Layer Security，传输层安全）。最后，我们会学习Node的加密模块，以及如何为密码加密。

我最喜欢的Node的功能之一，就是它可以通过子进程（child process）来调用系统功能。很多我喜欢的小型工具类应用，比如用来压缩文件的应用、图形处理应用（如ImageMagick）、从网站截图的应用，都不是特别大型的应用，无须复杂的云接口，但却是学习子进程的绝佳方式。我们会在第8章介绍子进程。

本书中大部分的示例代码，都是用大家熟知的JavaScript编写的。但是，Node.js和io.js分离又合并的原因，就在于对新版ECMAScript（比如ES6或者ECMAScript 2015）的支持。在第9章中，我会介绍当前Node版本所支持的功能、新功能的影响，以及什么时候应该用新功能取代旧功能。我还会介绍在使用JavaScript新功能时的一些陷阱。另外，我会讲解Bluebird的promise功能，这是本书中唯一一个脱离Node原生功能的部分。

第10章会讲解全栈Node编程（full-stack Node developement）所涉及的框架和功能。我会讲到Express—— 一个被普遍使用的Node组件，还会讲到MongoDB和Redis。我们还会学习组成全栈开发的另外两个框架：AngularJS和Backbone.js。

编程结束之后，你可能会想把自己的代码发布到产品环境中，第11章讲解了一些在开发环境和产品环境中需要用到的工具和技术，包括单元测试、负载测试和基准测试，以及一些基本的调试技术和工具。读者还会学到如何保证程序持续运行，以及如何在程序崩溃时自动重启。

第12章属于“饭后甜点”。在这一章，我会指引读者将已有的Node知识用于新的世界，包括属于物联网的微控制器和微计算机，以及一个并不运行在V8引擎上的新版本Node。

## 本书约定

本书中使用了以下字体作为约定内容。

等宽字体（ `constant width` ）

用于表示对代码的指代和段落内对程序元素的指代，比如变量名、函数名、数据库、数据类型、环境变量、声明和关键字。

#### 粗体（bold）

用于表示用户应该手动输入的命令或者文本。

等宽斜体（Constant width italic）

表示用户应该使用自己的内容或者上下文相关的内容来替代等宽斜体文字。

> <img class="my_markdown" src="./images/2.png" style="zoom:50%;" />
> 这个图片表示一个提示或者建议。



> <img class="my_markdown" src="./images/3.png" style="zoom:50%;" />
> 这个图片表示一个一般说明。



> <img class="my_markdown" src="./images/4.png" style="zoom:50%;" />
> 这个图片表示一个警告或者注意事项。

## 代码示例的使用

本书的目的是为了帮助读者完成工作。一般而言，读者可以在自己的程序和文档中使用本书中的代码，而且也没有必要取得我们的许可。但是，如果要复制的是核心代码，则需要和我们打个招呼。例如，可以在无须获取我们许可的情况下，在程序中使用本书中的多个代码块。但是，销售或分发O’Reilly图书中的代码光盘则需要取得我们的许可。通过引用本书中的示例代码来回答问题时，不需要事先获得我们的许可。但是，如果产品文档中融合了本书中的大量示例代码，则需要取得我们的许可。

在引用本书中的代码示例时，如果能列出本书的属性信息是最好不过了。一个属性信息通常包括书名、作者、出版社和ISBN。例如：“learning Node, Second Edition, by Shelley Powers (O’Reilly). Copyright 2016 Shelley Powers, 978-1-491-94312-0.”

在使用书中的代码时，如果不确定是否属于正常使用，或是否超出了我们的许可，请通过permissions@oreilly.com与我们联系。

## 联系方式

如果你想就本书发表评论或有任何疑问，敬请联系出版社。

美国：

O’Reilly Media Inc.

1005 Gravenstein Highway North

Sebastopol, CA 95472

中国：

北京市西城区西直门南大街2号成铭大厦C座807室（100035）

奥莱利技术咨询（北京）有限公司

### Safari® 在线图书

Safari在线图书是一个按需订阅的数字图书馆。它至少有7 500本与技术和创意相关的图书和视频供你参考和搜索。

通过订阅，你可以在线阅读所有的页面和视频，甚至可以在手机或移动设备上在线阅读。你可以在图书出版前访问到它们，并给作者发送反馈。其他功能还包括：复制和粘贴代码、组织收藏夹、下载和标记章节、做笔记、打印等。

O’Reilly Media已经将本书的英文版上传到Safari在线图书服务。在safari官网上免费注册，你就可以访问本书所有章节以及类似主题的图书。

## 致谢

我要感谢帮助我写作此书的人：编辑，Meg Foley；技术评论人，Ethan Brown；文字编辑，Gillian McGarvey；校对人，Rachel Monaghan；索引人，Judy McConville；插画师，Rebecca Panzer；以及其他所有接触过此书的人！



