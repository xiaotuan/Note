

MySQL是由David Axmark、Allan Larsson和Michael Widenius 3个瑞典人于 20世纪 90年代开发的一个关系型数据库。最初，他们的目的是用自己的 ISAM（Indexed Sequential Access Method，索引顺序存取方法）和mSQL（Mini SQL，一种轻量级SQL数据库引擎技术）来连接访问表格，但后来发现mSQL的速度和灵活性不能满足需求，于是他们开发了几乎与mSQL API接口相同的数据库引擎，并用创始人之一Michael Widenius女儿My的名字命名，这就是MySQL的来由。

说到MySQL就不得不提到开源软件。在MySQL设计之初，就考虑了以后引入第三方代码的方便性，并于 2000年开始采用GPL（GNU General Public License）许可协议，使自己成了开源软件的一分子。开源战略对MySQL的发展和广泛应用，可以说起到了至关重要的作用。从MySQL的历史就可以看出，它最早起源于开源软件mSQL，并从中借鉴了许多东西。不仅开发MySQL用到了许多开源工具，而且MySQL的许多重要组件都直接来自其他第三方的贡献，如BDB存储引擎来自Berkeley DB，其具有里程碑意义的 Innodb数据库存储引擎也是来自芬兰 Innobase OY公司的贡献。

进入21世纪，MySQL的发展步入了快车道。MySQL自2001年开始引入InnoDB存储引擎，并于2002年正式宣布MySQL全面支持事务，满足事务ACID属性（Atomicity，原子性；Consistent，一致性；Isolation，隔离性；Durable，持久性），并支持外键约束，使MySQL具备了支持关键应用的最基本特性。2003年，MySQL 4.0发布，开始支持集合操作UNION。2004年，MySQL 4.1发布，增加了对子查询的支持。2005年，MySQL 5.0发布，增加了对视图（View）、数据库存储过程（Stored Procedure）、触发器（Trigger）、服务器端游标（Cursor），以及分布式事务协议XA等高级特性的支持。再加上从3.23.15就开始支持的复制特性，至此，MySQL从功能上已经具备了支持企业级应用的主要特性。在实际应用方面，LAMP（Linux + Apache + MySQL + Perl/PHP/Python）也逐渐成了 IT业广泛使用的Web应用架构。

大家知道ANSI/ISO SQL是公认的关系数据库标准。从SQL标准的符合性来说，MySQL不仅无法跟成熟的商业数据库相比，在开源数据库中也远不是最好的，比如 PostgreSQL 就是业界公认的ANSI/ISO SQL标准符合性最好的开源数据库，MySQL直到 5.0版本才支持的一些特性，PostgreSQL早都实现了。既然如此，为什么MySQL却在开源数据库中独占鳌头呢？根本的原因就是性能！

有专门机构的调查研究显示，许多数据库提供的功能特性，只有40%被用户经常使用，而一些复杂的高级功能特性不仅会增加系统的复杂性，而且往往还会引起性能问题。PostgreSQL是加州大学伯克利分校以教学为目的开发的数据库系统，以追求功能实现的“完美”为首要目标，虽然在标准的遵从性上比MySQL领先，但性能一直是其短板，很难支持较大的应用。而MySQL 的开发者，在性能与标准的取舍上，一直坚持性能优先的原则，从不为追求标准的符合性而牺牲性能。SQL标准符合性差是MySQL的弱点，但通过上述策略保证了MySQL在性能方面的优势。这就是MySQL在互联网行业非常流行的另一个重要原因，因为Web应用往往需要支持大量的数据和并发请求，性能常常是首要因素。

随着MySQL功能不断完善，性能不断提高，可靠性不断增强，从2005年开始，我们陆续将一些重要数据库迁移到MySQL。虽然相对于Oracle来说，MySQL比较简单，管理维护相对容易（这也是MySQL的另外一个优势），但在迁移及其后的管理维护过程中，我们也经常遇到一些问题，例如，MySQL 提供了许多存储引擎，这些存储引擎各有特点，在实际应用中应该怎样来选择？MySQL 出现了性能问题，应该如何来诊断和优化？在数据安全方面，究竟需要注意些什么？MySQL的锁机制有什么特点，如何减少锁冲突，提高并发度？

遇到诸如此类的问题，自然会想到查阅 MySQL 文档、上网搜索、到论坛找类似问题的答案或寻求帮助等。通过上述途径当然可以解决许多问题，但却需要花费大量的精力和时间，效率很低。因为，我们发现MySQL的文档很“精练”，也很零碎，远没有Oracle的文档那么详细系统；网上一搜，结果可能数以万计，面对浩如烟海的网页，要找出真正有用的信息决非易事（搜索引擎还有许多改进的余地）；至于论坛上的答案，又往往是五花八门，让人无所适从。我们作为专职 DBA 尚且如此，其他开发、维护人员可能就感到更困难了。而且，不同的 DBA 或开发人员遇到同一个问题，可能还要再次去寻求解决方案，造成不必要的重复劳动。

为改变这种状况，我们决定将 DBA 平时使用 MySQL 积累的经验，解决问题的方法和思路，以及我们对MySQL的认识等整理出来，编写了一本《MySQL实用手册》，供DBA组及公司其他同事参考。

在编写过程中，我们根据自己的经验列出了MySQL开发、管理过程中可能遇到的一些问题，收集了以前解决MySQL问题的方法，形成了实用手册的基本内容框架。在此基础上，我们又研究了MySQL官方手册，筛选比较重要、实用但MySQL手册讲得不够详细或内容过于零散的部分作为补充。为力求准确，我们还专门做了许多测试，比如有关MySQL锁的测试、事务完整性的测试等。基于实用为主的原则，《MySQL实用手册》的第一稿篇幅不多，包括“开发篇”、“优化篇”和“管理篇”3个部分。“开发篇”主要介绍了与MySQL数据库开发设计相关的一些问题，包括存储引擎选择原则，如何选择合适的数据类型，不同字符集的特点及设置，索引的设计原则，以及SQL注入的类型，程序设计实现中如何防范SQL注入类安全漏洞等。“优化篇”首先介绍了MySQL数据库优化调整的一般步骤和方法，随后分别就索引问题、SQL优化、数据库对象调整、锁问题、MySQL关键性能参数设置、I/O优化、应用程序优化等作了讨论，并介绍了两个简单实用的优化命令，特别对锁问题做了比较系统、详细的介绍和讨论。“管理篇”除备份恢复等基本内容外，还介绍了MySQL安全配置管理应注意的各个方面，以及管理维护中一些常用的命令和小技巧。

《MySQL实用手册》第一稿出来后，我们发给了一些公司的同事，大家反馈内容很实用，对MySQL的开发管理很有帮助。得到这个评价，我们心里已经很是欣慰了，当有同事建议我们将其出版时，更是超出了我们的预期，开始只是随口答应了一下，并没敢当真。后来，热心的同事替我们与出版社取得了联系，出版社看过内容介绍和提纲后，觉得内容不错，做一些补充和修改就可以出版。

得到这个回复，我们非常高兴。但高兴之余，心里也很忐忑。在我们的概念中，出书都是作家、专家，及各类名人的“专利”，我们这些无名之辈，有这个资格吗？此时，上级领导的支持、同事的不断鼓励，给了我们信心。虽然我们不是什么专家，写不出多么高深的东西，但作为工作在数据库开发管理第一线的工程师，遇到的实际问题可能更多、更具体，写出的东西也许更实用。MySQL 是一个开源数据库，开源的精神就是分享和交流，基于这一点，我们的顾虑就少了，也更加坦然了。在《MySQL实用手册》第一稿的基础上，根据同事和出版社的建议，对内容做了一些补充和修订，增加了“基础篇”，以利于初次接触MySQL的读者阅读；在“管理篇”中补充了有关复制、日志管理和MySQL集群的介绍，使本书的内容更加丰富，更加完善。在内容编排上，我们基本遵循由易到难、循序渐进的原则，最后就形成了《深入浅出MySQL：数据库开发、优化与管理维护》一书。

本书第1版出版后，得到了不少同学的支持和肯定，这给了我们极大的鼓舞。随着MySQL新版本的不断推出，书中的一些内容已经过时，于是出版社的编辑建议我们对此书进行修订和升级。在编辑的支持和鼓励下，根据MySQL 5.5的新特性和近两年的应用实践，我们对本书内容进行了大量的修订，不但调整了本书的结构，还重新撰写了部分内容，并增加了分区、高可用架构、数据库监控等新内容，使本书的品质得到了进一步的提升。

对这本书的编写和改编过程，也是我们对MySQL再学习、再认识的过程。MySQL有许多优势，当然也还存在许多不足，但现在的 MySQL 应该说是值得信赖的，伴随着开源软件的发展，相信MySQL的未来也是值得期待的。这也正是我们把MySQL介绍给大家的原因，希望能对您有所帮助。由于我们的水平所限，书中谬误和不足可能难免，敬请广大同行批评指正！

**网易公司技术部DBA组**

**2013年11月于北京**

**序**

互联网的快速发展离不开各种技术和软件的普及与应用。作为开源软件的代表，MySQL数据库随着其功能的日益完善和可靠性的不断提高，已经成为互联网平台上应用广泛的数据库软件。网易公司成立十几年来，推出了众多网民所喜爱的产品与服务，其中MySQL数据库在后台也扮演了重要的角色。在应用MySQL的过程中，我们的工程师曾遇到了形形色色的问题，从开发技巧到管理维护，从性能问题到安全问题。本着交流和分享的精神，他们将多年实践中积累的经验和心得整理出来，编写了《MySQL实用手册》，在网易公司内部进行了交流，受到很大欢迎。在此基础上，他们联系出版机构将实用手册完善后出版，希望和国内更多的MySQL用户分享与交流。

这本书从应用开发、管理优化、系统维护3个角度，由浅入深地介绍了MySQL数据库各方面的知识，还从应用的角度总结了网易工程师遇到的各种问题以及解决方法，对实际工作者具有一定的实践指导意义。值此新书即将出版之际，谨向此书的作者团队表示祝贺，也真诚地期待读者朋友们提出宝贵意见。我们希望“网聚人的力量”，共同为互联网的技术和应用的发展不懈努力。



![figure_0008_0002.jpg](./images/figure_0008_0002.jpg)
**网易公司总裁**

