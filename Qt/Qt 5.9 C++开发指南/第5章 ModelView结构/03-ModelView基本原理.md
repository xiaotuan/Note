### 5.1.1　Model/View基本原理

GUI应用程序的一个很重要的功能是由用户在界面上编辑和修改数据，典型的如数据库应用程序。数据库应用程序中，用户在界面上执行各种操作，实际上是修改了界面组件所关联的数据库内的数据。

将界面组件与所编辑的数据分离开来，又通过数据源的方式连接起来，是处理界面与数据的一种较好的方式。Qt使用Model/View结构来处理这种关系，Model/View的基本结构如图5-1所示。其中各部分的功能如下。

![86.png](../images/86.png)
<center class="my_markdown"><b class="my_markdown">图5-1　Model/View基本结构（来自Qt帮助文件）</b></center>

+ 数据（Data）是实际的数据，如数据库的一个数据表或SQL查询结果，内存中的一个StringList，或磁盘文件结构等。
+ 视图或视图组件（View）是屏幕上的界面组件，视图从数据模型获得每个数据项的模型索引（model index），通过模型索引获取数据，然后为界面组件提供显示数据。Qt提供一些现成的数据视图组件，如QListView、QTreeView和QTableView等。
+ 模型或数据模型（Model）与实际数据通信，并为视图组件提供数据接口。它从原始数据提取需要的内容，用于视图组件进行显示和编辑。Qt中有一些预定义的数据模型，如QStringListModel可作为StringList的数据模型，QSqlTableModel可以作为数据库中一个数据表的数据模型。

由于数据源与显示界面通过Model/View结构分离开来，因此可以将一个数据模型在不同的视图中显示，也可以在不修改数据模型的情况下，设计特殊的视图组件。

在Model/View结构中，还提供了代理（Delegate）功能，代理功能可以让用户定制数据的界面显示和编辑方式。在标准的视图组件中，代理功能显示一个数据，当数据被编辑时，代理通过模型索引与数据模型通信，并为编辑数据提供一个编辑器，一般是一个QLineEdit组件。

模型、视图和代理之间使用信号和槽通信。当源数据发生变化时，数据模型发射信号通知视图组件；当用户在界面上操作数据时，视图组件发射信号表示这些操作信息；当编辑数据时，代理发射信号告知数据模型和视图组件编辑器的状态。

