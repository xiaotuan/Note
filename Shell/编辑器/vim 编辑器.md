[toc]

### 1. 检查 vim 软件包

在有些发行版本中安装的是完整的 vim，另外还有一个 `vi` 命令的别名，就像下面所显示的 CentOS 发行版本中那样：

```shell
$ alias vi
alias vi='vim'
$
$ which vim
/usr/bin/vim
$
$ ls -l /usr/bin/vim
lrwxrwxrwx 1 root root 21 9月   3 11:13 /usr/bin/vim
```

在其他发行版中，你会发现各式各样的 `vim` 编辑器。要注意的是，在 Ubuntu 发行版中不仅没有 `vi` 命令的别名，而且 `/usr/bin/vi` 程序属于一系列文件链接中的一环：

```shell
$ alias vi
bash: alias: vi：未找到
$ which vi
/usr/bin/vi
$ ls -l /usr/bin/vi
lrwxrwxrwx 1 root root 20 3月  14 10:28 /usr/bin/vi -> /etc/alternatives/vi
$ ls -l /etc/alternatives/vi
lrwxrwxrwx 1 root root 18 9月   3 11:13 /etc/alternatives/vi -> /usr/bin/vim.tiny
$ ls -l /usr/bin/vim.tiny 
-rwxr-xr-x 1 root root 2906824 2月   1  2022 /usr/bin/vim.tiny
$ readlink -f /usr/bin/vi
/usr/bin/vim.tiny
```

### 2. 安装 vim

在 Ubuntu 发行版中可以使用如下命令安装 vim：

```shell
$ sudo apt-get install vim
正在读取软件包列表... 完成
正在分析软件包的依赖关系树       
正在读取状态信息... 完成       
将会同时安装下列软件：
  vim-runtime
建议安装：
  ctags vim-doc vim-scripts
下列【新】软件包将被安装：
  vim vim-runtime
升级了 0 个软件包，新安装了 2 个软件包，要卸载 0 个软件包，有 16 个软件包未被升级。
需要下载 7,110 kB 的归档。
解压缩后会消耗 34.6 MB 的额外空间。
您希望继续执行吗？ [Y/n] y
[...]
```

### 3. 使用 vim 编辑文件

`vim` 编辑器在内存缓冲区中处理数据。只要键入 `vim` 命令（或 vi，如果这个别名或链接文件存在的话）和要编辑的文件的名字就可以启动 `vim` 编辑器：

```shell
$ vim myprog.c
```

如果在启动 `vim` 时未指定文件名，或者这个文件不存在，`vim` 会开辟一段新的缓冲区域来编辑。如果你在命令行下指定了一个已有文件的名字，`vim` 会将文件的整个内容都读到一块缓冲区域来准备编辑。

### 4. vim 编辑器的操作模式

`vim` 编辑器有两种操作模式：

+ 普通模式
+ 插入模式

当你刚打开要编辑的文件时（或新建一个文件时），`vim` 编辑器会进入普通模式。在普通模式中，`vim` 编辑器会将按键解释成命令。

在插入模式下，`vim` 会将你在当前光标位置输入的每个键都插入到缓冲区。按下 <kbd>i</kbd> 键就可以进入插入模式。要退出插入模式回到普通模式，按下键盘的退出键（<kbd>ESC</kbd> 键）就可以了。

### 5. 移动光标命令

在普通模式中，可以用方向键在文本区域移动光标（只要 `vim` 能正确识别你的终端类型）。如果你恰巧在一个古怪的没有定义方向键的终端连接上，也不是完全没有希望。`vim` 中有用来移动光标的命令：

+ `h`：左移一个字符。
+ `j`：下移一行（文本中的下一行）。
+ `k`：上移一行（文本中的上一行）。
+ `l`：右移一个字符。

+ `PageDown`（或 <kbd>Ctrl</kbd> + <kbd>F</kbd>）：下翻一屏。
+ `PageUp`（或 <kbd>Ctrl</kbd> + <kbd>B</kbd>）：上翻一屏。
+ `G`：移到缓冲区的最后一行。
+ `num G`：移动到缓冲区中的第 num 行。
+ `gg`：移动到缓冲区的第一行。

### 6. 退出 vim 命令

`vim` 编辑器在普通模式下有个特别的功能叫**命令行模式**。要进入命令行模式，在普通模式下按下冒号键。光标会移动到消息行，然后出现冒号，等待输入命令。

在命令行模式下有几个命令可以将缓冲区的数据保存到文件中并退出 `vim`：

+ `q`：如果未修改缓冲区数据，退出。
+ `q!`：取消所有对缓冲区数据的修改并退出。
+ `w filename`：将文件保存到另一个文件中。
+ `wq`：将缓冲区数据保存到文件中并退出。

### 7. vim 编辑命令

| 命令   | 描述                                                         |
| ------ | ------------------------------------------------------------ |
| x      | 删除当前光标所在位置的字符                                   |
| dd     | 删除当前光标所在行                                           |
| dw     | 删除当前光标所在位置的单词                                   |
| d$     | 删除当前光标所在行行尾的内容                                 |
| J      | 删除当前光标所在行行尾的换行符（拼接行）                     |
| u      | 撤销前一编辑命令                                             |
| a      | 在当前光标后追加数据                                         |
| A      | 在当前光标所在行行尾追加数据                                 |
| r char | 用 char 替换当前光标所在位置的单个字符                       |
| R text | 用 text 覆盖当前光标所在位置的数据，直到按下 <kbd>ESC</kbd> 键 |

有些编辑命令允许使用数字修饰符来指定重复该命令多少次。比如，命令 `2x` 会删除从光标当前位置开始的两个字符，命令 `5dd` 会删除从光标当前所在行开始的 5 行。

> 说明：在 `vim` 编辑器的普通模式下使用退格键（<kbd>Backspace</kbd> 键）和删除键（<kbd>Delete</kbd> 键）时要留心。`vim` 编辑器通常会将删除键识别成 `x` 命令的功能，删除当前光标所在位置的字符。`vim` 编辑器在普通模式下通常不识别退格键。

### 8. 复制和粘贴

剪切和粘贴相对容易，但 `vim` 在删除数据时，实际上会将数据保存在单独的一个寄存器中，可以用 `p` 命令取回数据。

举例来说，可以用 `dd` 命令删除一行文本，然后把光标移动到缓冲区的某个要放置该行文本的位置，然后用 `p` 命令。该命令会将文本插入到当前光标所在行之后。可以将它和任何删除文本的命令一起搭配使用。

复制文本则要稍微复杂点。`vim` 中复制命令是 `y` （代表 yank）。可以在 `y` 后面使用和 `d` 命令相同的第二字符（`yw` 表示复制一个单词，`y$` 表示复制到行尾）。在复制文本后，把光标移动到你想放置文本的地方，输入 `p` 命令。复制的文本就会出现在该位置。

**可视模式**会在你移动光标时高亮显示文本。可以用可视模式选取要复制的文本。要进入可视模式，应移动光标到要开始复制的位置，并按下 <kbd>v</kbd> 键。你会注意到光标所在位置的文本已经被高亮显示了。下一步，移动光标来覆盖你想要复制的文本（甚至可以向下移动几行来赋值更多行的文本）。在移动光标时，`vim` 会高亮显示赋值区域的文本。在覆盖了要复制的文本后，按 <kbd>y</kbd> 键来激活复制命令。现在寄存器中已经有了要复制的文本，移动光标到你要放置的位置，使用 <kbd>p</kbd> 命令来粘贴。

### 9. 查找和替换

要输入一个查找字符串，就按下斜线（`/`）键。光标会跑到消息行，然后 `vim` 会显示出斜线。在输入你要查找的文本后，按下回车键。`vim` 编辑器会采用以下三种回应中的一种。

+ 如果要查找的文本出现在光标当前位置之后，则光标会跳到该文本出现的第一个位置。
+ 如果要查找的文本未在光标当前位置之后出现，则光标会绕过文件末尾，出现在该文本所在的第一个位置（并用一条消息指明）。
+ 输出一条错误消息，说明在文件中没有找到要查找的文本。
+ 要继续查找同一个单词，按下斜线键，然后按回车键。或者使用 n 键，表示下一个。

替换命令允许你快速用另一个单词来替换文本中的某个单词。必须进入命令行模式才能使用替换命令。替换命令的格式是：

```shell
:s/old/new/
```

`vim` 编辑器会跳到 old 第一次出现的地方，并用 new 来替换。可以对替换命令作一些修改来替换多处文本。

+ `:s/old/new/g`：一行命令替换所有 old。
+ `:n,ms/old/new/g`：替换行号 n 和 m 之间所有 old。
+ `:%s/old/new/g`：替换整个文件中的所有 old。
+ `:%s/old/new/gc`：替换整个文件中的所有 old，但在每次出现时提示。

