[toc]

你已经知道了如何在 `sed` 命令中使用模式来替代数据流中的文本。然而在使用通配符时，很难知道到底哪些文本会匹配模式。

例如你在模式中用通配符（`.`）来匹配多个单词：

```shell
$ echo "The cat sleeps in his hat." | sed 's/.at/". at"/g'
The ". at" sleeps in his ". at".
```

模式字符串用点号通配符来匹配 at 前面的一个字母。遗憾的是，用于替代的字符串无法匹配单词中的通配符字符。

### 1. & 符号

`&` 符号可以用来代表替换命令中的匹配的模式。不管模式匹配的是什么样的文本，你都可以在替代模式中使用 `&` 符号来使用这段文本。

```shell
$ echo "The cat sleeps in his hat." | sed 's/.at/"&"/g'
The "cat" sleeps in his "hat".
```

### 2. 替代单独的单词

`&` 符号会提取匹配替换命令中指定模式的整个字符串。有时你只想提取这个字符串的一部分。`sed` 编辑器用圆括号来定义替换模式中的子模式。你可以在替代模式中使用特殊字符来引用每个子模式。替代字符由反斜线和数字组成。数字表明子模式的位置。`sed` 编辑器会给第一个子模式分配字符 \1，给第二个子模式分配字符 \2，依此类推。

> 警告：当在替换命令中使用圆括号时，必须用转义字符将它们标示为分组字符而不是普通的圆括号。这跟转义其他特殊字符正好相反。

```shell
$ echo "The System Administrator manual" | sed 's/\(System\) Administrator/\1 User/'
The System User manual
```

当需要在两个或多个子模式间插入文本时，这个特性尤其有用。

```shell
$ echo "1234567" | sed '{:start ; s/\(.*[0-9]\)\([0-9]\{3\}\)/\1,\2/; t start}'
1,234,567
```

