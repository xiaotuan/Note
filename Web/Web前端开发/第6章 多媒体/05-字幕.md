[toc]

### 1. 标记时间的文本轨道

网络视频文本轨道（简称为 WebVTT）是用于标记文本轨道的文件格式。它与 HTML5 的 `<track>` 元素相结合，可给音频、视频等媒体资源添加字幕、标题和其他描述信息，并同步显示。

#### 1.1 文件内容

WebVTT 文件是一个简单的纯文本文件，里面包含了一下几种类型的视频信息。

字幕：关于对话的转译或者翻译。

标题：类似于标题，但是还包括音响效果和其他音频信息。

说明：预期为一个单独的文本文件，通过屏 阅读其描述视频。

章节：旨在帮助用户浏览整个视频。

元数据：默认不打算展示给用户的、和视频有关的信息和内容。

#### 1.2 文件格式

WebVTT 文件是一个以 UTF-8 为编码，以 .vtt 为文件扩展名的简单文本文件。它遵循由 W3C 规范所定义的特定格式。

WebVTT 文件的头部按如下顺序定义。

① 可选的字节顺序标记（BOM）。

② 字符串 WEBVTT。

③ 一个空格（Space）或者制表符（Tab），后面接任意非回车换行的元素。

④ 两个或两个以上的 "WEBVTT 行结束符": 回车]r，换行\n，或者同时回车换行\r\n，具体文件格式如下：

```vtt
1
00:00:02.900 --> 00:00:08.370
字幕或标题内容
```

 #### 1.3 WebVTT 标记

WebVTT 文件可以包含一个或多个 "WebVTT Cues"，之间用两个或多个 WebVTT 行结束符分隔开。

WebVTT 标记允许指定特定时间戳范围内的文字（如字幕），同时也可以给 WebVTT 标记指定一个唯一的标识符，标识符由简单字符串构成，不包含 -->，也不包含任何的 WebVTT 行结束符，具体格式如下：

```vtt
[idstring]
[hh:]mm:ss.msmsms --> [hh:]mm:ss.msmsms
字幕或标题内容
```

标识符是可选项，可有可无，但最好是加入标识符，因为它能够帮组组织文件，也方便脚本操控。

时间戳遵循一个标准格式：小时部分[hh:]是可选的，毫秒和秒用一个点（如 "."）分隔，而不是冒号 ":"，时间戳范围的后者必须大于前者。对于不同的 Cues，时间戳可以重叠，但在单个标记中，不能有字符串 --> 或两个连续的行结束符。

时间范围后的文字可以是单行或者多行。特定的时间范围之后的任何文本都与该时间范围匹配，直到一个新的 Cue 出行或文件结束。WebVTT cue 的具体格式如下：

```vtt
1
00:00:02.900 --> 00:00:08.370
模特 - 李荣浩
2
00:00:09.600 --> 00:00:15.194
词：周耀辉
```

#### 1.4 WebVTT Cue 设置

在时间范围值后面，可以为标记做设置，具体设置规则如下：

```vtt
[idstring]
[hh:]mm:ss.msmsms --> [hh:]mm:ss.msmsms[标记设置]
文本内容
```

<center><b>表 6-4 WebVTT Cue 设置</b></center.
</center>

| 设置     | 值                     | 功能说明                                        |
| -------- | ---------------------- | ----------------------------------------------- |
| vertical | `rl | lr`              | 将文本纵向向左对齐（lr）或向右对齐（rl）        |
| line     | `[-][0 or more]`       | 行位置，负数从框底部数起，正数从顶部数起        |
| position | `[0-100]%`             | 百分数意味着文件开始时离框左边的位置            |
| size     | `.[0-100]%`            | 百分数意味着 cue 框的大小是整体框架宽度的百分比 |
| align    | `start | middle | end` | 指定 cue 中文本的对齐方式                       |

> 注意：如果没有设置 Cue 选项，默认位置是底部居中。

```vtt
1
00:00:02.900 --> 00:00:08.370 align:start size:15%
模特 - 李荣浩
2
00:00:09.600 --> 00:00:15.194 align:end line:10%
词：周耀辉
```

#### 1.5 WebVTT 标记内联样式

<center><b>表 6-5 WebVTT Cue 内联样式</b></center>

| 值   | 功能说明                                                     |
| ---- | ------------------------------------------------------------ |
| c    | 用 c 定义（CSS）类，例如，<c.className>Cue text</c>          |
| i    | 斜体字                                                       |
| b    | 粗体字                                                       |
| u    | 添加下划线                                                   |
| ruby | 定义类似于 HTML5 的 `<ruby>` 元素。在这样的内联样式中，允许出行一个或多个 `<rt>` 元素（`<ruby>` 元素用于标注汉字等东亚字符的发音） |
| v    | 如有提供，则用来指定声音标签。例如，`<v lan>This is useful for adding subtitles</v>`。注意此声音标签不会显示，它只是作为一个样式标记 |

一些 WebVTT 标记组件的使用示例如下：

```vtt
1
00:00:02.900 --> 00:00:08.370
<v Emo>模特 - 李荣浩<c.question>什么？</c></v>
2
00:00:09.600 --> 00:00:15.194
<v Proog>词：周耀辉</v>
```

这个例子给标记文本添加两种不同的声音标签：Emo 和 Proog。另外，一个 question 的 CSS 类被指定，可以按惯常方法在 CSS 链接文件或 HTML 页面里为其指定样式。

注意要给标记文本添加 CSS 样式，你需要用到一个特定的伪选择元素，代码如下：

```css
video:cue(v[voice="Emo"]) {
    color:lime
}
```

给标记文本添加时间戳也是可能的，表示在不同的时间以不同的内联样式出行，具体应用代码如下：

```vtt
3
00:00:52.000 --> 00:00:54.000
<c>你觉得呢？</c><00:00:53:500><c>是不是这样子？</c>
```

#### 1.6 使用 `<track>` 元素

HTML5 的 `<track>` 元素可以把外部轨道文件链接到特定资源上。

<center><b>表 6-6 track 元素属性</b></center>

<table>
    <tr>
      <th>名称</th>
      <th>值</th>
      <th>说明</th>
    </tr>
    <tr>
      <td rowspan="5">kind</td>
      <td>subtitles</td>
      <td>字幕</td>
    </tr>
    <tr>
      <td>captions</td>
      <td>标题，不仅仅是标题，还包括音效及其他音频信息</td>
    </tr>
    <tr>
      <td>description</td>
      <td>描述，视频的文本描述</td>
    </tr>
    <tr>
      <td>chapters</td>
      <td>章节导航</td>
    </tr>
    <tr>
      <td>metadata</td>
      <td>元数据</td>
    </tr>
    <tr>
      <td>src</td>
      <td>URL</td>
      <td>指定资源URL</td>
    </tr>
    <tr>
      <td>srclang</td>
      <td>Language code</td>
      <td>在 src 资源的语言</td>
    </tr>
    <tr>
      <td>label</td>
      <td>Free text</td>
      <td>给元素添加标签</td>
    </tr>
    <tr>
      <td>default</td>
      <td>n/a</td>
      <td>如果存在，且用户无其他特别设定，这个元素默认启用</td>
    </tr>
</table>

`<track>` 元素是 `<audio>` 或 `<video>` 的子元素，可定义多个 `<track>` 元素，提供不同语言的字幕或不同的文本轨道。

```track
<video controls>
	<source src="elephants-dream.mp4" type="video/mp4">
	<source src="elephants-dream.webm" type="video/webm">
	<track label="English subtitles" kind="subtitles" srclang="en" src="elephants-dream-subtitles-en.vtt" default>
	<track label="Deutsche Untertitel" kind="subtitles" srclang="de" src="elephants-dream-subtitles-de.vtt">
	<track label="English chapters" kind="chapters" srclang="en" src="elephants-dream-subtitles-en.vtt">
</video>
```

### 2. 视频字幕

**案例：示例 6-09：带字幕的视频播放器**

```html
<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta keywords="HTML5 Video Audio">
		<meta content="使用多种媒体格式提升兼容性">
		<title>带字幕的播放器</title>
	</head>

	<body>
		<center>
			<h1>播放视频</h1>
			<!--视频播放器 begin-->
			<video controls>
				<source src="medias/MoTe.mp4">
				<track label="模特字幕" kind="subtitles" srclang="zh" src="medias/zh.vtt" default>
				您的浏览器不支持video元素
			</video>
			<!--视频播放器 end-->
		</center>
	</body>
</html>
```

**zh.vtt**

```vtt
WEBVTT

1
00:00:02.900 --> 00:00:08.370
模特 - 李荣浩

2
00:00:09.600 --> 00:00:15.194
词：周耀辉

3
00:00:16.680 --> 00:00:23.910
曲：李荣浩

4
00:00:35.000 --> 00:00:40.519
穿华丽的服装 为原始的渴望而站着

5
00:00:42.220 --> 00:00:47.020
用完美的表情 为脆弱的城市而撑着

6
00:00:49.000 --> 00:00:55.593
我冷漠的接受 你焦急的等待也困着

7
00:00:56.200 --> 00:01:02.593
像无数生存在橱窗里的模特

8
00:01:04.000 --> 00:01:08.593
除了灯以外 我还能看见什么

9
00:01:08.600 --> 00:01:12.594
除了光以外 我还能要求什么

10
00:01:12.400 --> 00:01:19.500
除了你以外 还能倚赖哪一个

11
00:01:19.600 --> 00:01:23.000
在千里以外 在呼喊的是什么

12
00:01:23.500 --> 00:01:26.239
在百年以后 想回忆的是什么

13
00:01:26.880 --> 00:01:31.500
在离开以前 能否再见那一刻

14
00:01:32.600 --> 00:01:37.589
记得 你的眼睛将会亮着

15
00:01:38.440 --> 00:01:41.590
我的手臂将会挥着

16
00:01:42.600 --> 00:01:46.909
谁说世界早已没有选择

17
00:01:48.680 --> 00:01:55.513
趁着我会喜怒你会哀乐 唱几分钟情歌

18
00:01:57.680 --> 00:02:04.592
没什么 至少证明我们还活着

19
00:02:04.600 --> 00:02:09.349
像单纯的蝴蝶 为玫瑰的甜美而飞着 

20
00:02:11.160 --> 00:02:16.349
像顽皮的小猫 为明天的好奇而睡着

21
00:02:17.160 --> 00:02:24.349
是混乱的时代 是透明的监狱也觉得

22
00:02:25.160 --> 00:02:31.349
是不能继续在橱窗里做模特 

23
00:02:33.160 --> 00:02:37.349
除了风以外 我还能听到什么

24
00:02:38.160 --> 00:02:40.349
除了尘以外 我还能拒绝什么

25
00:02:41.160 --> 00:02:46.349
除了你以外 还能倚赖哪一个

26
00:02:48.160 --> 00:02:51.349
在千里以外 在呼喊的是什么

27
00:02:51.160 --> 00:02:55.349
在百年以后 想回忆的是什么

28
00:02:56.160 --> 00:03:00.349
在离开以前 能否再见那一刻

29
00:03:02.160 --> 00:03:05.349
记得 你的眼睛将会亮着

30
00:03:07.160 --> 00:03:09.349
我的手臂将会挥着

31
00:03:10.160 --> 00:03:14.349
谁说世界早已没有选择

32
00:03:16.160 --> 00:03:21.349
趁着 我会喜怒你会哀乐

33
00:03:22.160 --> 00:03:29.349
唱几分钟情歌

34
00:03:30.160 --> 00:03:35.349
没什么 至少证明我们还活着

35
00:03:56.160 --> 00:04:01.349
记得 你的眼睛将会亮着

36
00:04:02.160 --> 00:04:05.349
我的手臂将会挥着

37
00:04:06.160 --> 00:04:11.349
谁说世界早已没有选择


38
00:04:12.160 --> 00:04:16.349
趁着 我会喜怒你会哀乐


39
00:04:17.160 --> 00:04:18.349
唱几分钟情歌

40
00:04:20.160 --> 00:02:26.349
没什么 至少证明我们还活着
```

