### 17.1.1　C#中操作文件的流模型——文件和流

C#中流的概念可以和生活中的“流”相对应。在生活中有水流、电流等，首先要有一个源头，还要有传输的管道，水流有河床、水管等作为传输管道，电流有电线，而这些“流”都会有一个目的地，就是它的流向。C#中的流也需要有源头——文件，还要有数据流入/流出的管道以及数据的流向。

C#中流是面向对象的抽象概念，是二进制字节序列。文件从广义上可看成是保存在磁盘上的二进制字节，是按照一定格式存储的信息，因此能用流对文件进行操作，如读取文件内容、将信息写入文件等。文件和流的区别可以认为是：文件是存储在存储介质上的数据集，是静态的，它具有名称和相应的路径。当打开一个文件并对其进行读/写时，该文件就成为流（Stream）。不过，流不仅仅是指打开的磁盘文件，还可以是网络数据、控制台应用程序中的键盘输入和文本显示，甚至是内存缓存区的数据读/写。因此，流是动态的，它代表正处于输入/输出状态的数据，是一种特殊的数据结构。

在C#中通过.NET的System.IO模型以流的方式对各种数据文件进行访问，按照流的方向把流分为两种：输入流和输出流。输入流用于将数据读到程序可以访问的内存或变量中。输入流可以来自任何源，在此我们主要分析读取磁盘文件，可以理解为以文件为源，以内存为目的地。输出流用于向某些外部目标写入数据，可以是磁盘文件、打印设备或另一个程序。在此我们主要关注以内存为源、以文件为目的地的输出流。

System.IO模型提供了一个面向对象的方法来访问文件系统，提供了很多针对文件、文件夹的操作功能，特别是以流（Stream）的方式对各种数据进行访问，这种访问方式不但灵活，而且可以保证编程接口的统一。

System.IO模型实现包含在System.IO命名空间中，该命名空间包含允许在数据流和文件上进行同步和异步读取及写入、提供基本文件和文件夹操作的各种类，即System.IO模型是一个文件操作类库，包含的类可用于文件的创建、读/写、复制、移动和删除等操作。System.IO命名空间常用的类如下表所示。

| 类名称 | 说明 |
| :-----  | :-----  | :-----  | :-----  |
| Directory | 公开用于创建、移动和枚举通过目录和子目录的静态方法。无法继承此类 |
| DirectoryInfo | 公开用于创建、移动和枚举目录和子目录的实例方法。无法继承此类 |
| DriveInfo | 提供对有关驱动器的信息的访问 |
| File | 提供用于创建、复制、删除、移动和打开文件的静态方法，并协助创建Filestream对象 |
| FileInfo | 提供创建、复制、删除、移动和打开文件的实例方法，并且帮助创建FileStream对象，无法继承此类 |
| FileStream | 公开以文件为主的Stream，既支持同步读/写操作，也支持异步读/写操作 |
| MemoryStream | 创建其支持存储区为内存的流 |
| Stream | 提供字节序列的一般视图 |
| StreamReader | 实现一个TextReader，使其以一种特定的编码从字节流中读取字符 |
| StreamWriter | 实现一个TextWriter，使其以一种特定的编码向流中写入字符 |
| StringReader | 实现从字符串进行读取的TextReader |
| StringWriter | 实现一个用于将信息写入字符串的TextWriter。该信息存储在基础StringBuilder中 |
| TextReader | 表示可读取连续字符系列的读取器 |
| TextWriter | 表示可以编写一个有序字符系列的编写器。该类为抽象类 |
| BinaryReader | 用特定的编码将基元数据类型读做二进制值 |

System.IO命名空间的类大致可分为以下3组。

（1）操作流的类：包括文件流、内存流，以及读/写这些流的类。

（2）操作目录的类：包括对文件夹目录进行创建、移动、删除等操作，以及对磁盘信息进行访问的类。

（3）操作文件的类：包括对文件进行创建、移动、删除等操作，以及获取文件信息等。

比较常用的类有FileStream类、StreamReader类、StreamWriter类、BinaryReader类、BinaryWriter类、MemoryStream类、File类、FileInfo类、Directory类和DirectoryInfo类等。

Stream类是所有流类的抽象基类，它提供了流的基本功能。流是字节序列的抽象概念，如文件、输入/输出设备、内部进程通信管道或者TCP/IP套接字等都可以看做流。流涉及以下3个基本操作。

（1）从流读取：读取是从流到数据结构（如字节数组）的数据传输。

（2）向流写入：写入是从数据结构到流的数据传输。

（3）支持查找：查找是对流内的当前位置进行查询和修改。

System.IO模型中，借助文件流进行文件操作的常用步骤如下。

（1）用File类打开操作系统文件。

（2）建立对应的文件流，即FileStream对象。

（3）用StreamReader/StreamWriter类提供的方法对文件流（文本文件）进行读/写或用BinaryReader/BinaryWriter类提供的方法对文件流（二进制文件）进行读/写。

