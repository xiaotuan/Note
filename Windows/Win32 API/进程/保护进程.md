如果要保护 WPE 不会被非法关闭，可以从两个方面入手，一个是防止此进程被其他进程检测到，另一个是防止此进程被其他进程终止。

在检测系统进程的时候，一般的程序都使用 ToolHelp 函数或者是 Process Status 函数（即上面所述的 `EnumProcess` 系列的函数），所以只要 HOOK 掉系统对这些函数的调用，使这些函数的返回结果中不包含要包含的进程即可。

更简单的办法就是直接 HOOK 掉其他进程对 `TerminateProcess` 函数的调用。因为一个进程要结束另外一个进程一般都调用 `TerminateProcess` 函数，包括 Windows 自带的任务管理器。

