[toc]

C-风格字符串具有一种特殊的性质：以空字符（null character）结尾，空字符被写作 \0，其 ASCII 码为 0，用来标记字符串的结尾。例如，请看下面两个声明：

```c++
char dog[8] = { 'b', 'e', 'a', 'u', 'x', ' ', 'I', 'I' };	// not a string!
char cat[8] = { 'f', 'a', 't', 'e', 's', 's', 'a', '\0' };	// a string!
```

可以使用字符串常量或字符串字面值初始化字符数组：

```c++
char bird[11] = "Mr. Cheeps";	// the \0 is understood
char fish[] = "Bubbles";	// let the compiler count
```

用引号括起来的字符串隐式地包括结尾的空字符，因此不用显示地包括它。

### 1. 拼接字符串常量

事实上，任何两个由空白（空格、制表符和换行符）分隔的字符串常量都将自动拼接成一个。因此，下面所有的输出语句都是等效的：

```c++
cout << "I'd give my right arm to be" " a great violinist.\n";
cout << "I'd give my right arm to be a great violinist.\n";
cout << "I'd give my right ar"
    "m to be a great violinist.\n";
```

注意，拼接时不会在被连接的字符串之间添加空格。

### 2. 在数组中使用字符串

要将字符串存储到数组中，最常用的方法有两种——将数组初始化为字符串常量、将键盘或文件输入读入到数组中。

**程序清单4.2 string.cpp**

```c++
// strings.cpp -- storing strings in an array
#include <iostream>
#include <cstring>	// for the strlen() function

int main()
{
	using namespace std;
	const int Size = 15;
	char name1[Size];	// empty array
	char name2[Size] = "C++owboy";	// initialized array
	// NOTE: some implementations may require the static keyword
	// to initialize the array name2

	cout << "Howdy! I'm " << name2;
	cout << "! What's your name?\n";
	cin >> name1;
	cout << "Well, " << name1 << ", your name has ";
	cout << strlen(name1) << " letters and is stored\n";
	cout << "in an array of " << sizeof(name1) << " bytes.\n";
	cout << "Your initial is " << name1[0] << ".\n";
	name2[3] = '\0';	// set to null character
	cout << "Here are the first 3 characters of my name: ";
	cout << name2 << endl;
	return 0;
}
```

运行后输出结果如下所示：

```console
Howdy! I'm C++owboy! What's your name?
Basicman
Well, Basicman, your name has 8 letters and is stored
in an array of 15 bytes.
Your initial is B.
Here are the first 3 characters of my name: C++
```

> 从上面程序可以看出，sizeof 运算符指出整个数组的长度：15 字节，但 strlen() 函数返回的是存储在数组中的字符串的长度，而不是数组本身的长度。另外，strlen() 只计算可见的字符，而不把空字符计算在内。

### 3. 字符串输入

**程序清单4.3 instr1.cpp**

```c++
// instr1.cpp -- reading more than one string
#include <iostream>

int main()
{
	using namespace std;
	const int ArSize = 20;
	char name[ArSize];
	char dessert[ArSize];

	cout << "Enter your name:\n";
	cin >> name;
	cout << "Enter your favorite dessert:\n";
	cin >> dessert;
	cout << "I have some delicious " << dessert;
	cout << " for you, " << name << ".\n";
	return 0;
}
```

运行后输出如下所示：

```console
Enter your name:
Alistair Dreeb
Enter your favorite dessert:
I have some delicious Dreeb for you, Alistair.
```

cin 使用空白（空格、制表符和换行符）来确定字符串的结束位置，这意味着 cin 在获取字符数组输入时只读取一个单词。

### 4. 每次读取一行字符串输入

istream 中的类（如 cin）提供了一些面向行的类成员函数：getline() 和 get()。这两个函数都读取一行输入，直到到达换行符。然而，随后 getline() 将丢弃换行符，而 get() 将换行符保留在输入序列中。

#### 4.1 面向行的输入： getline()

getline() 函数读取整行，它使用通过回车键输入的换行符来确定输入结尾。要调用这种方法，可以使用 cin.getline()。该函数有两个参数。第一个参数是用来存储输入行的数组的名称，第二个参数是要读取的字符数。如果这个参数为 20，则函数最多读取 19 个字符，余下的空间用于存储自动在结尾处添加的空字符。getline() 成员函数在读取指定数目的字符或遇到换行符时停止读取。

**程序清单4.4 instr2.cpp**

```c++
// instr2.cpp -- reading more than one word with getline
#include <iostream>

int main()
{
	using namespace std;
	const int ArSize = 20;
	char name[ArSize];
	char dessert[ArSize];

	cout << "Enter your name: \n";
	cin.getline(name, ArSize);	// reads through newline
	cout << "Enter your favorite dessert:\n";
	cin.getline(dessert, ArSize);
	cout << "I have some delicious " << dessert;
	cout << " for you, " << name << ".\n";
	return 0;
}
```

运行后输出结果如下所示：

```console
Enter your name:
Dirk Hammernose
Enter your favorite dessert:
Radish Torte
I have some delicious Radish Torte for you, Dirk Hammernose.
```

#### 4.2 面向行的输入：get()

get() 成员函数接受的参数与 getline() 相同，解释参数的方式也相同，并且都读取到行为。但 get 并不在读取并丢弃换行符，而是将其留在输入队列中。

get() 有另一种变体，使用不带任何参数的 cin.get() 调用可读取下一个字符（即使是换行符），因此可以用它来处理换行符，为读取下一行输入做好准备。

```c++
cin.get(name, ArSize);	// read first line
cin.get();	// read newline
cin.get(dessert, Arsize);	// read second line
```

另一种使用 get() 的方式是将两个类成员函数拼接起来（合并），如下所示：

```c++
cin.get(name, ArSize).get();	// concatenate member functions
```

**程序清单4.5 instr3.cpp**

```c++
// instr3.cpp -- reading more than one word with get() & get()
#include <iostream>

int main()
{
	using namespace std;
	const int ArSize = 20;
	char name[ArSize];
	char dessert[ArSize];

	cout << "Enter your name:\n";
	cin.get(name, ArSize).get();	// read string, newline
	cout << "Enter your favorite dessert:\n";
	cin.get(dessert, ArSize).get();
	cout << "I have some delicious " << dessert;
	cout << " for you, " << name << ".\n";
	return 0;
}
```

运行后输出如下所示：

```console
Enter your name:
Mai Parfait
Enter your favorite dessert:
Chocolate Mousse
I have some delicious Chocolate Mousse for you, Mai Parfait.
```

为什么要使用 get()，而不是 getline() 呢？首先，老式实现没有 getline()。其次，get() 使输入更仔细。例如，假设用 get() 将一行读入数组中。如何知道停止读取的原因是由于已经读取了整行，而不是由于数组已填满呢？查看下一个输入字符，如果是换行符，说明已读取了整行；否则，说明该行中还有其他输入。

#### 4.3 空行和其他问题

当 getline() 或 get() 读取空行时，将发生什么情况？最初的做法是，下一条输入语句将前一条 getline() 或 get() 结束读取的位置开始读取；但当前的做法是，当 get() （不是 getline()）读取空行后将设置失效位（failbit）。这意味着接下来的输入将被阻断，但可以用下面的命令来恢复输入：

```c++
cin.clear();
```

另一个潜在的问题是，输入字符串可能比分配的控空间长。如果输入行包含的字符数比指定的多，则 getline() 和 get() 将把余下的字符留在输入队列中，而 getline() 还会设置失效为，并关闭后面的输入。

### 5. 混合输入字符串和数字

**程序清单4.6 numstr.cpp**

```c++
// numstr.cpp -- following number input with line input 
#include <iostream>

int main()
{
	using namespace std;
	cout << "What year was your house built?\n";
	int year;
	cin >> year;
	cout << "What is its street address?\n";
	char address[80];
	cin.getline(address, 80);
	cout << "Year built: " << year << endl;
	cout << "Address: " << address << endl;
	cout << "Done!\n";
	return 0;
}
```

运行后输出如下所示：

```console
What year was your house built?
1966
What is its street address?
Year built: 1966
Address:
Done!
```

用户根本没有输入地址的机会。问题在于，当 cin 读取年份，将回车键生成的换行符留在了输入队列中。后面的 cin.getline() 看到换行符后，将认为是一个空行，并将一个空字符串赋给 address 数组。解决之道是，在读取地址之前先读取并丢弃换行符。这可以通过几种方法来完成，其中包括使用没有参数的 get() 和使用接受一个 char 参数的 get()。

```c++
cin >> year;
cin.get();	// or cin.get(ch);
```

也可以利用表达式 cin >> year 返回 cin 对象，将调用拼接起来：

(cin >> year).get();	// or (cin >> year).get(ch);

