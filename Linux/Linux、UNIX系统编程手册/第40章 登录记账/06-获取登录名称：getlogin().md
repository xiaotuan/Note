### 40.5　获取登录名称：getlogin()

getlogin()函数返回登录到调用进程的控制终端的用户名，它会使用在utmp文件中维护的信息。



![1003.png](../images/1003.png)
getlogin()函数会调用ttyname()（参见62.10节）来找出与调用进程的标准输入相关联的终端名，接着它将搜索utmp文件以找出ut_line值与终端名匹配的记录。如果找到了匹配的记录，那么getlogin()会返回记录中的ut_user字符串。

如果没有找到匹配的记录或者发生了错误，那么getlogin()会返回NULL并设置errno来标示错误。getlogin()可能会失败的一个原因是进程没有一个与其标准输入相关联的终端（ENOTTY），这可能是因为进程本身是一个daemon。另一个可能的原因是终端会话并没有记录在utmp文件中，如一些软件终端模拟器不会在utmp文件中创建条目。

即使当一个用户ID在/etc/passwd文件中拥有多个登录名时（不常见），getlogin()还是能够返回登录进这个终端的实际用户名，因为它依赖的是utmp文件。相反，getpwuid(getuid())总是会返回/etc/passwd中第一个匹配的记录，不管登录名是什么。

> SUSv3规定了getlogin()的一个可重入版本getlogin_r()，glibc提供了这个函数。
> LOGNAME环境变量也可以用来找出用户的登录名。但用户可以改变这个变量的值，这表示无法使用这个变量来安全地识别出一个用户。

