### 2.4 CPLD和FPGA

CPLD（复杂可编程逻辑器件）由完全可编程的与或门阵列以及宏单元构成。

CPLD中基本逻辑单元是宏单元，宏单元由一些“与或”阵列加上触发器构成，其中“与或”阵列完成组合逻辑功能，触发器完成时序逻辑。宏单元中与阵列的输出称为乘积项，其数量标志了CPLD的容量。乘积项阵列实际上就是一个“与或”阵列，每一个交叉点都是一个可编程熔丝，如果导通就是实现“与”逻辑。在“与”阵列后一般还有一个“或”阵列，用以完成最小逻辑表达式中的“或”关系。图2.20所示为非常典型的CPLD的单个宏单元的结构。

![P58_38606.jpg](../images/P58_38606.jpg)
图2.21给出了一个典型CPLD的整体结构。这个CPLD由LAB（逻辑阵列模块，由多个宏单元组成）通过PIA（可编程互连阵列）互连组成，而CPLD与外部的接口则由I/O控制模块提供。

图中宏单元的输出会经I/O控制块送至I/O引脚，I/O控制块控制每一个I/O引脚的工作模式，决定其为输入、输出还是双向引脚，并决定其三态输出的使能端控制。

与CPLD不同，FPGA（现场可编程门阵列）基于LUT（查找表）工艺。查找表本质上是一片RAM，当用户通过原理图或HDL（硬件描述语言）语言描述了一个逻辑电路以后，FPGA开发软件会自动计算逻辑电路的所有可能的结果，并把结果事先写入RAM。这样，输入一组信号进行逻辑运算就等于输入一个地址进行查表输出对应地址的内容。

![P58_38617.jpg](../images/P58_38617.jpg)
图2.22所示为一个典型的FPGA的内部结构。这个FPGA由IOC（输入/输出控制模块）、EAB（嵌入式阵列块）、LAB和FAST TRACK（快速通道互连）构成。

![P59_38631.jpg](../images/P59_38631.jpg)
IOC是内部信号到I/O引脚的接口，它位于FAST TRACK的行和列的末端，每个IOC包含一个双向I/O缓冲器和一个既可做输入寄存器也可做输出寄存器的触发器。

EAB（嵌入式存储块）是一种输入输出端带有寄存器的非常灵活的RAM。EAB不仅可以用作存储器，也可以事先被写入查表值来以用来构成如乘法器、纠错逻辑等电路。当用于RAM时，EAB可配制成8位、4位、2位和1位长度的数据格式。

LAB主要用于逻辑电路设计，一个LAB包括多个LE（逻辑单元），每个LE包括组合逻辑及一个可编程触发器。一系列LAB构成的逻辑阵列用来实现普通逻辑功能，如计数器、加法器、状态机等。

器件内部信号的互连和器件引出端之间的信号互连由FAST TRACK连线提供，FAST TRACK遍布于整个FPGA器件，是一系列水平和垂直走向的连续式布线通道。

表2.1所示为一个4输入LUT的实际逻辑电路与LUT实现方式的对应关系。

**表2.1 实际逻辑电路与查找表的实现**



| 实际逻辑电路 | LUT的实现方式 |
| :-----  | :-----  | :-----  | :-----  |
| <img class="my_markdown" src="https://cdn.ptpress.cn/pubcloud/5B0A982E/ushu/N16780/online/FBOL6c694c89b7725/Images/BZ___59_134_1337_437_1414.png" style="width:306px;  height: 79px; "/> | <img class="my_markdown" src="https://cdn.ptpress.cn/pubcloud/5B0A982E/ushu/N16780/online/FBOL6c694c89b7725/Images/BZ___59_579_1320_899_1431.png" style="width:322px;  height: 113px; "/> |

| a，b，c，d 输入 | 逻 辑 输 出 | 地 址 | RAM中存储的内容 |
| :-----  | :-----  | :-----  | :-----  | :-----  | :-----  |
| 0000 | 0 | 0000 | 0 |
| 0001 | 0 | 0001 | 0 |
| .... | 0 | ... | 0 |
| 1111 | 1 | 1111 | 1 |

CPLD和FPGA的主要厂商有Altera、Xilinx和Lattice等，采用专门的开发流程，在设计阶段使用HDL语言（如VHDL、Verilog HDL）编程。它们可以实现许多复杂的功能，如实现UART、I2C等I/O控制芯片、通信算法、音视频编解码算法等，甚至还可以直接集成ARM等CPU核和外围电路。

对于驱动工程师而言，我们只需要这样看待CPLD和FPGA：如果它完成的是特定的接口和控制功能，我们就直接把它当成由很多逻辑门（与、非、或、D触发器）组成的完成一系列时序逻辑和组合逻辑的ASIC；如果它完成的是CPU的功能，我们就直接把它当成CPU。驱动工程师眼里的硬件比IC设计师要宏观。

