### 4.10 使用模块绕开GPL

对于企业自己编写的驱动等内核代码，如果不编译为模块则无法绕开GPL，编译为模块后企业在产品中使用模块，则公司对外不再需要提供对应的源代码，为了使公司产品所使用的Linux操作系统支持模块，需要完成如下工作。

● 在内核编译时应该选上“可以加载模块”，嵌入式产品一般不需要动态卸载模块，所以“可以卸载模块”不用选。

● 将我们编译的内核模块.ko文件应该放置在目标文件系统的相关目录中。

● 产品的文件系统中应该包含了支持新内核的insmod、lsmod、rmmod等工具，由于嵌入式产品中一般不需要建立模块间依赖关系，所以modprobe可以不要，一般也不需要卸载模块，所以rmmod也可以不要。

● 在使用中用户可使用insmod命令手动加载模块，如insmod xxx.ko。

● 但是一般而言，产品在启动过程中应该加载模块，在嵌入式产品Linux的启动过程中，加载企业自己的模块的最简单的方法是修改启动过程的rc脚本，增加insmod /.../xxx.ko这样的命令。用busybox做出的文件系统，通常修改etc/init.d/rcS文件。

