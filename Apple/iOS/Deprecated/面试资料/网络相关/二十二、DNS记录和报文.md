###### 二十二、DNS记录和报文

* **1、资源记录**

所有DNS服务器都存储了**资源记录（Resource Record，RR）**，其提供了主机名到IP的映射。
资源记录是一个包含以下字段的四元组：
**（Name，Value，Type，TTL）**
TTL是该记录的生存时间，决定了资源记录应当从缓存中删除的时间。
Name和Value的值取决于Type(以下涉及的foo,bar均为伪变量)：

* Type = A，则Name是主机名，Value使其对应的IP地址。这也是一个标准的主机名到IP地址的映射。如(replay1.bar.foo.com,145.37.93.126,A)
* Type = NS，则Name是个域（如`foo.com`），而Value是个知道如何获取该域中主机IP地址的权威DNS服务器的主机名，如(foo.com,dns.foo.com,NS)
* Type = CNAME,则Name是别名为Name的主机对应的规范主机名。该记录能够向查询的主机提供一个主机名对应的规范主机名，如（foo.com,replay1.bar.foo.com,CNAME）
* Type = MX，则Value是个别名为Name的邮件服务器的规范主机名。如（foo.com,main.bar.foo.com,MX）

**2、DNS报文**

DNS只有查询和回答两种报文，这两种报文格式是一样的。

* 前12个字节是**首部区域**。
标识符用于标识该查询，这个标识符会被复制到对查询的回答报文中，以便让客户用它来匹配发送的请求和接收到的回答。
标志字段中含有若干标志。1比特的“查询/回答”标志位指出报文是查询报文（0）还是回答报文（1）。当某DNS服务器是所请求名字的权威DNS服务器时，1比特的“权威的”标志位被置在回答报文中。此外，还有“希望递归”、“递归可用”等标志位。
在首部中，还有4个数量相关的字段，指出来在首部后的4类数据区域出现的数量，其中RR是资源记录的意思。

* **问题区域**包含着正在进行的查询信息。该区域包括：️名字字段，指出正在被查询的主机名字；️类型字段，指出有关该名字的正被查询的问题类型，即上边说的四元组中的Type

* **回答区域**包含了对最初请求的名字的资源记录。在回答区域中可以包含多条RR，因此一个主机名理论上能够有多个IP地址（不同用户在不同地点访问同一个域名，可能会访问到不同的IP地址）

* **权威区域**中包含了其他权威服务器的记录

* **附加区域**包含了其他有帮助的记录

得知DNS的报文格式后，我们也就可以手动发送DNS查询包了。
一个在线DNS查询的工具：https://tool.lu/dns/index.html