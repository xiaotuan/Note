[toc]

### 1. MTK

#### 1.1 MT8766

##### 1.1.1 Android T

在 `sys` 和 `vnd` 目录下的客制化目录中添加 `WB_AUDIO_EARPIECT_CLOSE=yes` 宏。

具体修改内容如下：

1. 在 `vnd/device/mediatek/芯片名称/audio_policy_config/` 目录（例如, `device/mediatek/mt6761/audio_policy_config/`）下拷贝 `audio_policy_configuration.xml` 文件并重命名为 `audio_policy_configuration_no_earpiece.xml`，然后修改如下内容：

   ```diff
   @@ -46,7 +46,9 @@
            <module name="primary" halVersion="3.0">
                <attachedDevices>
                    <item>Speaker</item>
   -                <item>Earpiece</item>
   +                <!-- Start remove earpiece device by qty -->
   +                <!--<item>Earpiece</item>-->
   +               <!-- End remove earpiece device by qty -->
                    <item>Built-In Mic</item>
                    <item>Built-In Back Mic</item>
                    <item>FM Tuner In</item>
   @@ -104,12 +106,16 @@
                </mixPorts>
                <devicePorts>
                    <!-- Output devices declaration, i.e. Sink DEVICE PORT -->
   +               <!-- Start remove earpiece device by qty -->
   +                <!--
                    <devicePort tagName="Earpiece" type="AUDIO_DEVICE_OUT_EARPIECE" role="sink">
                       <profile name="" format="AUDIO_FORMAT_PCM_32_BIT"
                                 samplingRates="44100 48000" channelMasks="AUDIO_CHANNEL_OUT_MONO"/>
                       <profile name="" format="AUDIO_FORMAT_PCM_16_BIT"
                                 samplingRates="44100 48000" channelMasks="AUDIO_CHANNEL_OUT_MONO"/>
                    </devicePort>
   +               -->
   +               <!-- End remove earpiece device by qty -->
                    <devicePort tagName="Speaker" role="sink" type="AUDIO_DEVICE_OUT_SPEAKER">
                        <profile name="" format="AUDIO_FORMAT_PCM_32_BIT"
                                 samplingRates="44100 48000" channelMasks="AUDIO_CHANNEL_OUT_STEREO"/>
   @@ -227,8 +233,12 @@
                </devicePorts>
                <!-- route declaration, i.e. list all available sources for a given sink -->
                <routes>
   +               <!-- Start remove earpiece device by qty -->
   +                <!--
                    <route type="mix" sink="Earpiece"
                           sources="primary output,deep_buffer,Voice Call In"/>
   +               -->
   +               <!-- End remove earpiece device by qty -->
                    <route type="mix" sink="Speaker"
                           sources="primary output,deep_buffer,FM Tuner In,Voice Call In"/>
                    <route type="mix" sink="Wired Headset"
   ```

2. 修改 `vnd/device/mediatek/vendor/common/device.mk 