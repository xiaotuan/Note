<center><font size="5"><b>多平台程序设计</b></font></center>

总得来说，多平台并不是为所有平台编译全部代码。这个模型有其明显的局限性，我们知道现代应用程序需要访问其所运行平台的独有特性。Kotlin 并不会限制你只使用其中所有 API的公共子集。 每个组件都可以根据需要与其他组件共享尽可能多的代码， 而通过语言所提供的 expect / actual 机制可以随时访问平台 API。

以下是在极简版日志框架中公共逻辑与平台逻辑之间代码共享与交互的示例。其公共代码如下所示：

```kotlin
// 为所有平台编译
enum class LogLevel {
	DEBUG, WARN, ERROR
} 

// 预期的平台相关 API
internal expect fun writeLogMessage(message: String, logLevel: LogLevel)

// 可在公共代码中使用预期的 API
fun logDebug(message: String) = writeLogMessage(message, LogLevel.DEBUG)
fun logWarn(message: String) = writeLogMessage(message, LogLevel.WARN)
fun logError(message: String) = writeLogMessage(message, LogLevel.ERROR)
```

它期待目标平台为 writeLogMessage 提供平台相关实现，然后公共代码就可以使用此声明而无需考虑它是如何实现的。

在 JVM 上，可以提供一个将日志写到标准输出的实现：

```kotlin
internal actual fun writeLogMessage(message: String, logLevel: LogLevel) {
    println("[$logLevel]: $message")
}
```

在 JavaScript 世界中可用的是一组完全不同的 API， 因此可以实现为将日志记录到控制台：

```kotlin
internal actual fun writeLogMessage(message: String, logLevel: LogLevel) {
    when (logLevel) {
      LogLevel.DEBUG -> console.log(message)
      LogLevel.WARN -> console.warn(message)
      LogLevel.ERROR -> console.error(message)
    }
}
```

**Android —— iOS**

移动平台之间共享代码是 Kotlin 多平台的主要使用场景之一，现在可以通过在 Android 与iOS 之间共享部分代码（ 如业务逻辑、连接等） 来构建移动应用。
参见：

+ [移动端多平台特性、案例研究以及一些示例](https://www.jetbrains.com/lp/mobilecrossplatform/)
+ [搭建移动端多平台项目](https://www.kotlincn.net/docs/tutorials/native/mpp-ios-android.html)

**客户端——服务端**

代码共享可以带来收益的另一个场景是互联应用，其中的逻辑可以在服务器与运行在浏览器中的客户端中复用。Kotlin 多平台也覆盖了这个场景。

[Ktor 框架](https://ktor.kotlincn.net/)适用于在互联系统中构建异步的服务器与客户端。

**推荐教程**

+ [多平台 Kotlin 库](https://www.kotlincn.net/docs/tutorials/mpp/multiplatform-library.html)
+ [多平台项目：iOS 与 Android](https://www.kotlincn.net/docs/tutorials/native/mpp-ios-android.html)

**示例项目**

+ [KotlinConf app](https://github.com/JetBrains/kotlinconf-app)
+ [KotlinConf Spinner app](https://github.com/jetbrains/kotlinconf-spinner)

在 [GitHub](https://github.com/JetBrains/kotlin-examples) 上还有更多示例

